# Telegram Bot - FastAPI Version 4.2

Telegram-–±–æ—Ç –Ω–∞ Python —Å FastAPI, Uvicorn –∏ —Å–±–æ—Ä–æ–º –º–µ—Ç—Ä–∏–∫

## –í–µ—Ä—Å–∏–∏

### v4.2 (12.11.2025)
- ‚ú® –ù–æ–≤—ã–π –º–æ–¥—É–ª—å `collector.py` –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ —Å Binance API
- üìä –ö–æ–º–∞–Ω–¥–∞ `/now` –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ –ø–æ –≤—Å–µ–º –ø–∞—Ä–∞–º
- üíæ –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ JSON —Ñ–∞–π–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã
- üîá –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–∏—Ö–æ –±–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram
- ‚ö° –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

### v4.1 (12.11.2025)
- –ö–æ–º–∞–Ω–¥–∞ `/coins` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä –≤ `pairs.txt`

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.9+
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –¥–µ–ø–ª–æ–π

### –ù–∞ Render.com

- **Build Command**: `pip install -r requirements.txt`
- **Start Command**: `uvicorn main:app --host 0.0.0.0 --port $PORT`

### Environment Variables

- `BOT_TOKEN` - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
- `ADMIN_CHAT_ID` - ID –∞–¥–º–∏–Ω–∞
- `WEBHOOK_BASE` - URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://your-app.onrender.com`)
- `DATA_STORAGE` - —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `/var/data`)

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### `/start`
–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

### `/coins <pair1> <pair2> ...`
–î–æ–±–∞–≤–ª—è–µ—Ç –ø–∞—Ä—ã –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫

**–ü—Ä–∏–º–µ—Ä:**
```
/coins BTCUSDT ETHUSDT BNBUSDT
```

### `/now`
–°–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –≤—Å–µ–º –ø–∞—Ä–∞–º –∏–∑ `pairs.txt`

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ß–∏—Ç–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–∞—Ä –∏–∑ `pairs.txt`
2. –î–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å Binance:
   - –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ (ticker)
   - –°–≤–µ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (4h, 1h, 15m)
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª `{SYMBOL}.json`
4. **–ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram** (–º–æ–ª—á–∞)

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
```
DATA_STORAGE/
  BTCUSDT.json
  ETHUSDT.json
  BNBUSDT.json
  pairs.txt
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON:**
```json
{
  "symbol": "BTCUSDT",
  "timestamp": "2025-12-12T06:26:00.000000+00:00",
  "ticker": {
    "symbol": "BTCUSDT",
    "price": 42500.00,
    "bid_price": 42499.90,
    "ask_price": 42500.10,
    "high": 43000.00,
    "low": 42000.00,
    "volume": 15000.5,
    "quote_asset_volume": 637500000.00,
    "trades": 500000
  },
  "klines": {
    "4h": [...],
    "1h": [...],
    "15m": [...]
  }
}
```

### `/data`
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

### `/data export all`
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –≤ —á–∞—Ç

### `/data delete all`
–£–¥–∞–ª—è–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã

## –ú–æ–¥—É–ª–∏

### `collector.py`
–ú–æ–¥—É–ª—å –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ —Å Binance API

**–§—É–Ω–∫—Ü–∏–∏:**
- `fetch_ticker_price()` - –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É
- `fetch_klines()` - –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–µ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `collect_metrics_for_symbol()` - —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ–¥–Ω–æ–π –ø–∞—Ä—ã
- `collect_all_metrics()` - —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä

**–î–∞–Ω–Ω—ã–µ:**
- –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ (price, bid, ask, high, low, volume)
- –°–≤–µ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è 4h, 1h, 15m –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ (OHLCV)

### `metrics.py`
–ú–æ–¥—É–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä–∞–º–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫

## –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç `/coins BTCUSDT ETHUSDT`
2. –ü–∞—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `pairs.txt`
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç `/now`
4. –ë–æ—Ç —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –≤—Å–µ–º –ø–∞—Ä–∞–º –∏–∑ `pairs.txt` (–±–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏–π)
5. –î–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã —Å–æ–∑–¥–∞–µ—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è JSON —Ñ–∞–π–ª
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ `/data export all`

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–≤–µ—Ä—Å–∏—è 5.0)

- –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (SMA, ATR)
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
- –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ñ–ª–∞–≥–æ–≤ —Ç–æ—Ä–≥–æ–≤–ª–∏
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ (schedule)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –º–µ—Ç—Ä–∏–∫

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
