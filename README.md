# Trader Bot — версия 1.7

Телеграм-бот под деплой на Render, работающий через webhook.

## Что изменено в версии 1.7

- Обновлена команда `/now`:
  - Если сырьевой файл `<SYMBOL>.json` **существует**, бот:
    - читает файл из `STORAGE_DIR`,
    - запрашивает последние ~50 свечей с Binance Spot для TF1 и TF2,
    - перезаписывает блок `raw[TF].candles` актуальными данными,
    - обновляет поле `updated_ts`.
  - Если сырьевого файла **нет**, бот создаёт только **каркас** структуры, как в версии 1.2:
    - `symbol`, `tf1`, `tf2`, `updated_ts`,
    - в `raw` для TF1 и TF2 — пустые массивы `candles`, `ma30`, `ma90`, `atr14`.
- Остальные команды (`/symbols`, `/help`, `/data`) работают так же, как в предыдущих версиях.

## История версий

- **1.7** — `/now` подтягивает свечи с Binance для уже существующих сырьевых файлов.
- **1.6** — фикс синтаксиса в `data.py`, стабильная работа `/data`.
- **1.5** — доработки `data.py`, устойчивый синтаксис.
- **1.4** — фикс модуля `data.py`.
- **1.3** — модуль `data.py`, команда `/data` для управления файлами в `STORAGE_DIR`.
- **1.2** — команда `/now`, создание/обновление сырых файлов `<SYMBOL>.json` по списку символов (каркас).
- **1.1** — команды `/help` и `/symbols`, файл `Bot_commands.txt`, работа с `symbols_list.json`.
- **1.0** — базовый скелет бота: FastAPI + webhook, health-check, уведомление админа о запуске.

## Переменные окружения

- `BOT_TOKEN` — токен Telegram-бота
- `ADMIN_CHAT_ID` — ID админского канала/чата
- `ADMIN_KEY` — ключ админа (в этой версии не используется)
- `BINANCE_API_KEY` — ключ Binance (в этой версии не используется)
- `BINANCE_API_SECRET` — секрет Binance (в этой версии не используется)
- `HTTP_PROXY` — HTTP-прокси (пока не используется)
- `HTTPS_PROXY` — HTTPS-прокси (пока не используется)
- `RAW_MAX_BYTES` — лимит размера raw-файлов (пока не используется)
- `STORAGE_DIR` — корень диска на Render для хранения state/raw-файлов
- `WEBHOOK_BASE` — публичный URL сервиса на Render без завершающего `/`
- `TF1` — старший таймфрейм
- `TF2` — младший таймфрейм
