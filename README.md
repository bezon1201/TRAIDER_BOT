# Trader Bot — версия 1.9

Телеграм-бот под деплой на Render, работающий через webhook.

## Что есть в версии 1.9

- Вебхук для Telegram через FastAPI.
- Health-check эндпоинты: `GET /health` и `HEAD /health`.
- Уведомление админа при запуске: сообщение "Бот запущен. Версия 1.9".
- Команда `/start` отвечает: "Бот онлайн. Версия 1.9".

### Команды

См. файл `Bot_commands.txt`, команда `/help` отправляет его содержимое в чат.

Кратко:

- `/symbols` — управление списком торговых пар (файл `symbols_list.json` в `STORAGE_DIR`).
- `/now` — сбор и пересчёт сырья по символам:
  - тянет с Binance до 100 свечей по `TF1` и `TF2`,
  - в `<SYMBOL>.json` пишет свечи, MA30/MA90/ATR14 массивы, сигналы и `trading_params`,
  - в `<SYMBOL>raw_market.jsonl` дописывает строки с `ts`, `symbol`, `market_mode`, `tf1`, `tf2`, `signal_tf1`, `signal_tf2`.
- `/market force` — голосовой расчёт режима рынка и создание `<SYMBOL>state.json` на основе сырья и raw_market.
- `/data` — работа с файлами в `STORAGE_DIR` (список, экспорт, удаление, импорт).

## Переменные окружения

- `BOT_TOKEN` — токен Telegram-бота
- `ADMIN_CHAT_ID` — ID админского канала/чата
- `ADMIN_KEY` — ключ админа (зарезервировано)
- `BINANCE_API_KEY` — ключ Binance (пока не используется)
- `BINANCE_API_SECRET` — секрет Binance (пока не используется)
- `HTTP_PROXY` — HTTP-прокси (пока не используется)
- `HTTPS_PROXY` — HTTPS-прокси (пока не используется)
- `RAW_MAX_BYTES` — лимит размера raw-файлов (пока не используется)
- `STORAGE_DIR` — корень диска на Render для хранения json/jsonl
- `WEBHOOK_BASE` — публичный URL сервиса на Render без завершающего `/`
- `TF1` — старший таймфрейм (например, "12")
- `TF2` — младший таймфрейм (например, "6")
- `MARKET_PUBLISH` — окно голосования по рынку в часах (например, 12, 24 и т.п.)

## История версий (кратко)

- **1.9** — фикс импорта роутеров и восстановление полноценного `metrics.py` и `data.py` (без плейсхолдеров), всё работает как в 1.8 + исправление.
- **1.8** — модуль `coin_state.py`, команда `/market force`, создание `<SYMBOL>state.json` из сырья и raw_market.
- **1.7** — расширенный `/now`: 100 свечей, расчёт MA/ATR/сигналов, `market_mode`, расширенный `trading_params`, лог `raw_market.jsonl`.
