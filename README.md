# Trader Bot — версия 1.2

Телеграм-бот под деплой на Render, работающий через webhook.

## Что есть в версии 1.2

- Добавлена команда `/now`:
  - `/now` — создаёт или обновляет сырые файлы `<SYMBOL>.json` для всех пар из `symbols_list.json`.
  - `/now btcusdc` — создаёт или обновляет сырьевой файл только для указанных пар.
- Сырьевые файлы `<SYMBOL>.json` хранятся в каталоге `STORAGE_DIR` и содержат базовую структуру для TF1/TF2:
  - `symbol`, `tf1`, `tf2`, `updated_ts`, блок `raw` с заготовками под `candles`, `ma30`, `ma90`, `atr14`.
- Логика `/help` и `/symbols` без изменений относительно 1.1, но живёт в обновлённом `metrics.py`.
- Стартовое сообщение и ответ `/start` обновлены до версии 1.2.

## Что было в версии 1.1

- Добавлена команда `/help`, которая отправляет содержимое файла `Bot_commands.txt`.
- Добавлена команда `/symbols`:
  - `/symbols` — показывает текущий список торговых пар из `symbols_list.json`.
  - `/symbols btcusdc, ethusdc` — перезаписывает `symbols_list.json` нормализованным списком в верхнем регистре.
- Файл `symbols_list.json` хранится на persistent-диске Render в каталоге `STORAGE_DIR`.
- Весь функционал команд `/help` и `/symbols` вынесен в модуль `metrics.py`.

## База из версии 1.0

- FastAPI-приложение с webhook-эндпоинтом для Telegram.
- Эндпоинт `GET /health` и `HEAD /health` для health-check'а Render.
- При старте сервиса:
  - устанавливается webhook на `WEBHOOK_BASE + "/webhook/<BOT_TOKEN>"`;
  - в канал/чат `ADMIN_CHAT_ID` отправляется сообщение о запуске с версией.
- Простейший хэндлер `/start` — отвечает сообщением с текущей версией.

## Переменные окружения

- `BOT_TOKEN` — токен Telegram-бота
- `ADMIN_CHAT_ID` — ID админского канала/чата
- `ADMIN_KEY` — ключ админа (в этой версии не используется)
- `BINANCE_API_KEY` — ключ Binance (не используется в 1.2)
- `BINANCE_API_SECRET` — секрет Binance (не используется в 1.2)
- `HTTP_PROXY` — HTTP-прокси (пока не используется)
- `HTTPS_PROXY` — HTTPS-прокси (пока не используется)
- `RAW_MAX_BYTES` — лимит размера raw-файлов (пока не используется)
- `STORAGE_DIR` — корень диска на Render для хранения state/raw-файлов
- `WEBHOOK_BASE` — публичный URL сервиса на Render без завершающего `/`
- `TF1` — старший таймфрейм
- `TF2` — младший таймфрейм

## История версий

- **1.2** — команда `/now`, создание/обновление сырых файлов `<SYMBOL>.json` по списку символов.
- **1.1** — команды `/help` и `/symbols`, файл `Bot_commands.txt`, работа с `symbols_list.json`.
- **1.0** — базовый скелет бота: FastAPI + webhook, health-check, уведомление админа о запуске.
